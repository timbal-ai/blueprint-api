<!DOCTYPE html>
<html>
  <head>
    <title>Sign In - Timbal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #0a0a0a;
        padding: 1rem;
      }
      .logo {
        margin-bottom: 1.5rem;
        height: 28px;
        width: auto;
      }
      .card {
        background: #18181b;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 400px;
        border: 1px solid #27272a;
      }
      .card-header {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
      }
      .card-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #fafafa;
        margin-bottom: 0.5rem;
      }
      .card-description {
        color: #a1a1aa;
        font-size: 0.875rem;
      }
      .card-content {
        padding: 1.5rem;
      }
      .alert {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        margin-bottom: 1rem;
        display: none;
      }
      .alert.error {
        background: #450a0a;
        border: 1px solid #991b1b;
        color: #fca5a5;
      }
      .alert.success {
        background: #052e16;
        border: 1px solid #166534;
        color: #86efac;
      }
      .alert.show { display: block; }
      .form-group {
        margin-bottom: 1rem;
      }
      label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #e4e4e7;
        margin-bottom: 0.5rem;
      }
      input {
        width: 100%;
        padding: 0.625rem 0.875rem;
        border: 1px solid #3f3f46;
        border-radius: 8px;
        font-size: 0.875rem;
        background: #27272a;
        color: #fafafa;
        transition: border-color 0.15s, box-shadow 0.15s;
        outline: none;
      }
      input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }
      input::placeholder { color: #71717a; }
      .btn {
        width: 100%;
        padding: 0.625rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-decoration: none;
        border: none;
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .btn-primary {
        background: #fafafa;
        color: #18181b;
      }
      .btn-primary:hover:not(:disabled) { background: #e4e4e7; }
      .btn-outline {
        background: transparent;
        color: #e4e4e7;
        border: 1px solid #3f3f46;
      }
      .btn-outline:hover { background: #27272a; }
      .oauth-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      .divider {
        display: flex;
        align-items: center;
        margin: 1.5rem 0;
      }
      .divider::before, .divider::after {
        content: "";
        flex: 1;
        height: 1px;
        background: #3f3f46;
      }
      .divider span {
        padding: 0 1rem;
        color: #71717a;
        font-size: 0.75rem;
        text-transform: uppercase;
      }
      .card-footer {
        padding: 0 1.5rem 1.5rem;
        text-align: center;
      }
      .card-footer p {
        color: #71717a;
        font-size: 0.875rem;
      }
      .oauth-icon {
        width: 18px;
        height: 18px;
      }
    </style>
  </head>
  <body>
    <svg class="logo" viewBox="0 0 1975.28 433.45" xmlns="http://www.w3.org/2000/svg">
      <g fill="#fff">
        <path d="M590.64,393.66v-207.41h-50.27v-53.97h50.27V50.79h64.55v81.48h50.8v53.97h-50.8v207.41h-64.55Z"/>
        <path d="M728.2,40.74c0-21.69,17.46-38.63,39.68-38.63s38.63,16.93,38.63,38.63-17.46,39.15-38.63,39.15c-22.22,0-39.68-17.46-39.68-39.15ZM735.61,132.28h64.55v261.38h-64.55V132.28Z"/>
        <path d="M856.24,393.66V132.28h59.26l5.29,30.69c13.23-21.69,39.68-38.63,77.25-38.63,39.68,0,67.2,19.58,80.95,49.74,13.23-30.16,43.92-49.74,83.6-49.74,63.49,0,98.42,38.1,98.42,98.42v170.9h-64.02v-153.97c0-37.57-20.11-57.14-50.8-57.14s-55.03,20.1-55.03,62.96v148.15h-64.55v-154.5c0-36.51-19.58-56.09-50.27-56.09s-55.56,20.11-55.56,62.44v148.15h-64.55Z"/>
        <path d="M1313.91,393.66V0h64.55v170.37c16.93-29.1,51.85-46.56,91.54-46.56,74.6,0,120.11,58.2,120.11,140.74s-49.21,135.98-124.34,135.98c-39.15,0-72.49-17.46-87.83-47.62l-4.23,40.74h-59.79ZM1452.54,341.28c45.5,0,72.49-32.81,72.49-79.37s-26.98-79.9-72.49-79.9-73.55,32.81-73.55,79.9,29.1,79.37,73.55,79.37Z"/>
        <path d="M1619.2,319.05c0-48.15,34.92-78.31,96.83-83.07l78.31-5.82v-5.82c0-35.45-21.16-49.74-53.97-49.74-38.1,0-59.26,15.87-59.26,43.39h-55.03c0-56.61,46.56-93.65,117.46-93.65s113.76,38.1,113.76,110.59v158.73h-56.62l-4.76-38.63c-11.11,26.98-46.56,45.5-87.3,45.5-55.56,0-89.42-32.28-89.42-81.48ZM1794.86,287.83v-13.76l-54.5,4.23c-40.21,3.7-55.56,16.93-55.56,38.1,0,23.81,15.87,35.45,44.98,35.45,39.68,0,65.08-23.81,65.08-64.02Z"/>
        <path d="M1911.26,393.66V0h64.02v393.66h-64.02Z"/>
        <polygon points="423.21 27.58 422.6 286.37 209.68 433.45 210.03 288.38 0 433.45 .61 174.66 213.53 27.58 213.18 172.65 423.21 27.58"/>
      </g>
    </svg>
    
    <div class="card">
      <div class="card-header">
        <h1 class="card-title">Welcome back</h1>
        <p class="card-description">Sign in to your account to continue</p>
      </div>
      
      <div class="card-content">
        <div id="error" class="alert error"></div>
        <div id="success" class="alert success"></div>
        
        <!-- Magic Link Form -->
        <form id="magic-link-form">
          <div class="form-group">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="name@example.com" required />
          </div>
          <button type="submit" class="btn btn-primary" id="magic-link-btn">
            Send magic link
          </button>
        </form>
        
        <div class="divider">
          <span>Or continue with</span>
        </div>
        
        <div class="oauth-buttons">
          <a href="/auth/github" class="btn btn-outline">
            <svg class="oauth-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
            </svg>
            Continue with GitHub
          </a>
          
          <a href="/auth/google" class="btn btn-outline">
            <svg class="oauth-icon" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
              <path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 009 18z" fill="#34A853"/>
              <path d="M3.964 10.71c-.18-.54-.282-1.117-.282-1.71s.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 000 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
              <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 00.957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z" fill="#EA4335"/>
            </svg>
            Continue with Google
          </a>
          
          <a href="/auth/microsoft" class="btn btn-outline">
            <svg class="oauth-icon" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
              <rect x="1" y="1" width="9" height="9" fill="#f25022"/>
              <rect x="11" y="1" width="9" height="9" fill="#7fba00"/>
              <rect x="1" y="11" width="9" height="9" fill="#00a4ef"/>
              <rect x="11" y="11" width="9" height="9" fill="#ffb900"/>
            </svg>
            Continue with Microsoft
          </a>
        </div>
      </div>
      
      <div class="card-footer">
        <p>Need access? Contact your administrator.</p>
      </div>
    </div>

    <script>
      const errorEl = document.getElementById('error');
      const successEl = document.getElementById('success');
      const form = document.getElementById('magic-link-form');
      const submitBtn = document.getElementById('magic-link-btn');

      // Show error from URL params
      const urlParams = new URLSearchParams(window.location.search);
      const error = urlParams.get('error');
      if (error) {
        const messages = {
          'auth_failed': 'Authentication failed. Please try again.',
          'no_access': 'You do not have access to this application.'
        };
        errorEl.textContent = messages[error] || 'Login failed';
        errorEl.classList.add('show');
      }

      // Magic link form submission
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        errorEl.classList.remove('show');
        successEl.classList.remove('show');
        
        const email = document.getElementById('email').value;
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';

        try {
          const res = await fetch('/auth/magic-link', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });

          const data = await res.json();
          
          if (res.ok) {
            successEl.textContent = 'Check your email for the login link!';
            successEl.classList.add('show');
            form.reset();
          } else {
            errorEl.textContent = data.error || 'Failed to send magic link';
            errorEl.classList.add('show');
          }
        } catch {
          errorEl.textContent = 'Network error. Please try again.';
          errorEl.classList.add('show');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Send magic link';
        }
      });
    </script>
  </body>
</html>
